{% extends 'base.html' %}

{% block title %}Change Password{% endblock %}

{% block content %}
<div class="container col-md-6 align-items-center ">
    <h2 class="text-center mt-4">Change Password</h2>
    <form id="changePasswordForm" class="shadow p-3" onsubmit="return submitChangePasswordForm(event)">
        <div class="mb-3">
            <label for="currentPassword" class="form-label">Current Password</label>
            <input type="password" class="form-control" id="currentPassword" name="currentPassword">
        </div>
        <div class="mb-3">
            <label for="newPassword" class="form-label">New Password</label>
            <input type="password" class="form-control" id="newPassword" name="newPassword">
        </div>
        <div class="mb-3">
            <label for="confirmPassword" class="form-label">Confirm New Password</label>
            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword">
        </div>
        <div class="d-grid">
            <button type="submit" class="btn text-white" style="background-color: blueviolet;">Change Password</button>
        </div>
    </form>
</div>

<script>
    function validateChangePasswordForm() {
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (!currentPassword) {
            alert('Please enter your current password.');
            document.getElementById('currentPassword').focus();
            return false;
        }

        if (!newPassword) {
            alert('Please enter your new password.');
            document.getElementById('newPassword').focus();
            return false;
        }

        if (!confirmPassword) {
            alert('Please enter your new password.');
            document.getElementById('newPassword').focus();
            return false;
        }

        if (newPassword !== confirmPassword) {
            alert('New password and confirm password do not match.');
            document.getElementById('confirmPassword').focus();
            return false;
        }

        return true;
    }

    async function submitChangePasswordForm(event) {
        event.preventDefault();
        if (!validateChangePasswordForm()) {
            return;
        }

        const form = event.target;
        const formData = new FormData(form);

        try {
            const response = await fetch('/change_password', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();
            if (response.ok) {
                alert(result.msg);
                window.location.href = '/';
            } else {
                alert(result.msg);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred');
        }
    }
</script>
{% endblock %}